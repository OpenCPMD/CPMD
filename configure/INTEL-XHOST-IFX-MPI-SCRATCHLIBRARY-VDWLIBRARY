#INFO#
#INFO# Configuration for Intel Skylake HPC architecture
#INFO# Modules needed: profile/base autoload intel/pe-xe-2016--binary
#INFO#                 intelmpi/5.1--binary mkl/11.3--binary
#INFO# Intel Composer v.18 or later [NOT FORMER] + IntelMPI 
#INFO# For optimal performance you should use the Intel xiar driver
#INFO# instead of the standard GNU ar
#INFO# -axSKYLAKE-AVX512 includes all the recommended options for that CPU family
#INFO# and should be preferred to -axCore-AVX512 under Intel v.18 or later
#INFO# See https://software.intel.com/en-us/forums/intel-c-compiler/topic/779347
#INFO# Note that the use of Intel Composer v.17-18-19 together with OpenMPI can
#INFO# cause MPI_Allreduce problems with sudden crash of the code. 
#INFO# (M. Boero, IPCMS & Nagoya University, 2019). 
#INFO#
     IRAT=2
     FC='mpiifx'
     CC='mpiicx'
     LD='mpiifx'
     CPP='/lib/cpp -P -traditional'
     CPPFLAGS='-D__HAS_FFT_FFTW3 -D__ALPHALINUX -D__HPC \
         -D__PARALLEL -D__HAS_SIZEOF -D__HAS_BF_STREAM_IO \
	 -D__INTEL_MKL -D__USE_SCRATCHLIBRARY \
	 -D__HAS_LIBGRIMMEVDW'
     CPPFLAGS_GROMOS='-DEWALD -DEWATCUT -DHAT_SHAPE -DUNPACKED_GRID \
             -D__HAS_FFT_FFTW3 -D__ALPHALINUX -D__HPC \
             -D__PARALLEL -D__HAS_SIZEOF -D__HAS_BF_STREAM_IO'
     FFLAGS_GROMOS='-fixed $(FFLAGS)'
     FFLAGS_GROMOS_MODULES=' $(FFLAGS)'
     AR='ar -r'
     RANLIB='/usr/bin/ranlib'
     if [ $debug ]; then
       FFLAGS='-pc64 -g -traceback -check all -O0 -pc64 -align array64byte -falign-loops=32 \
       -falign-functions=32 -fp-model=strict -fimf-use-svml=false -fp-model=source -fiopenmp -fopenmp-targets=spir64'
       CFLAGS='-g -Wall -m64 -Wno-error=int-conversion'
     else
       FFLAGS='-O2 -traceback -g -pc64 -funroll-loops -assume byterecl -align array64byte \
              -xHost -finline-functions -qopt-zmm-usage=high \
	      -I${CPMDROOT}/scratchmodule_lib/ -I${CPMDROOT}/vdw_lib/ '
       CFLAGS='-O2 -Wall -Wno-error=int-conversion'
     fi
     if [ $omp ]; then
       FFLAGS=${FFLAGS}' -qopenmp -qmkl=parallel'
       OMP3_DISABLED='false'
       LIBS=' -qmkl=parallel -lmkl_scalapack_lp64 -lmkl_blacs_intelmpi_lp64 -qopenmp \
             -L${CPMDROOT}/scratchmodule_lib/ -lscratch_module \
	     -L${CPMDROOT}/vdw_lib/ -lgrimmevdw'
     else
       FFLAGS=${FFLAGS}' -qmkl=sequential'
       LIBS=' -qmkl=sequential -lmkl_scalapack_lp64 -lmkl_blacs_intelmpi_lp64 \
             -L${CPMDROOT}/scratchmodule_lib/ -lscratch_module \
	     -L${CPMDROOT}/vdw_lib/ -lgrimmevdw '
     fi
     LFLAGS=${LIBS}
